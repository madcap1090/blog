<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Political ads on Facebook for the 2019 Belgian elections | bad to the code</title>

<meta property='og:title' content='Political ads on Facebook for the 2019 Belgian elections - bad to the code'>
<meta property='og:description' content='I was looking for a way to have the same level of analysis of Facebook that is possible with the Twitter API, but gave up after a short while. The API seems to me quite closed in terms of what information is made available by Facebook.
So I was quiet interested when I come across this blog post of Mr Schmidt not on an API for Facebook generally, but for Facebook ads.'>
<meta property='og:url' content='/post/political-ads-on-facebook-for-the-2019-belgian-elections/'>
<meta property='og:site_name' content='bad to the code'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/5f460ebf37e30791f47bb5be3de73e3a?s=256'><meta property='article:author' content='https://facebook.com/OClassicoOficial/videos/391802167961744/'><meta property='article:section' content='Post'><meta property='article:tag' content='Facebook'><meta property='article:tag' content='Belgian politics'><meta property='article:tag' content='nlp'><meta property='article:tag' content='topic modeling'><meta property='article:published_time' content='2020-01-04T00:00:00Z'/><meta property='article:modified_time' content='2020-01-04T00:00:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@WilliamBourgeoi'><meta name='twitter:creator' content='@WilliamBourgeoi'>


<link href="/index.xml" rel="alternate" type="application/rss+xml" title="bad to the code" />

<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="/">
          <h1 class="title is-4">bad to the code</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="facebook" href='https://facebook.com/OClassicoOficial/videos/391802167961744/'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:madcap1090@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/williambourgeois'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/WilliamBourgeoi'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/madcap1090'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/facebook">#Facebook</a>



  
  | <a class="subtitle is-6" href="/tags/belgian-politics">#Belgian politics</a>
  
  | <a class="subtitle is-6" href="/tags/nlp">#nlp</a>
  
  | <a class="subtitle is-6" href="/tags/topic-modeling">#topic modeling</a>
  

      
    </div>
    <h2 class="subtitle is-6">January 4, 2020</h2>
    <h1 class="title">Political ads on Facebook for the 2019 Belgian elections</h1>
    
    <div class="content">
      
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<p>I was looking for a way to have the same level of analysis of Facebook that is possible with the Twitter API, but gave up after a short while. The API seems to me quite closed in terms of what information is made available by Facebook.</p>
<p>So I was quiet interested when I come across <a href="http://rpubs.com/zoowalk/FB_EP2019">this</a> blog post of Mr Schmidt not on an API for Facebook generally, but for Facebook ads.</p>
<p>The increased transparency comes as a reaction against criticism on Facebook for running ‘manipulative’ political adds (lies) on it’s servers.</p>
<p>Let’s have a go at it (and thank you Mr. Schmidt ) and see what we can come up with related to the Belgian elections of May 2019 or more widely regarding Belgian political messages.</p>
<p>I am far from being an expert in Facebook advertising, so this is a blog on learning more about what we can get out of the API even though some are quite critical about the information it offers. See for instance <a href="https://blog.mozilla.org/blog/2019/04/29/facebooks-ad-archive-api-is-inadequate/">Facebook’s Ad Archive API is Inadequate</a>.</p>
<p>And amid new leaks reported <a href="https://www.theguardian.com/uk-news/2020/jan/04/cambridge-analytica-data-leak-global-election-manipulation">today</a> that show the vast extent of manipulation trough Facebook it seems important to have a closer look at what can be learned from the data Facebook provides.</p>
<pre class="r"><code>library(&quot;tidyverse&quot;)
library(&quot;lubridate&quot;)
library(&quot;scales&quot;)
library(&quot;lemon&quot;) 
library(&quot;DT&quot;)
library(&quot;extrafont&quot;)
library(&quot;httr&quot;)
library(&quot;rvest&quot;)
library(&quot;glue&quot;)
# you might need the dev version of tidyr needed for unnest_wider function 
# (and R ver 3.6)
library(&quot;tidyr&quot;) # devtools::install_github(&quot;tidyverse/tidyr&quot;)
library(&quot;stringi&quot;)
library(&quot;tokenizers&quot;) 
library(&quot;reactable&quot;) #install.packages(&quot;reactable&quot;)
library(&quot;scales&quot;)
options(scipen = 999)</code></pre>
<p>The way to go about is to go to Facebook for developers by creating an account and then create a new app. Add all the search fields you are interested in (I took all) and you then need a token that seems to be a temporary token (on this <a href="https://developers.facebook.com/tools/explorer/">portal</a>), meaning that it is only valid for a certain time and you need to re-generate it for your next run.</p>
<pre class="r"><code># https://www.facebook.com/ads/library/api/?source=archive-landing-page
# link to fb api
my_link &lt;- &quot;https://graph.facebook.com&quot;
my_token &lt;- &quot;put your token here&quot;

#define fields you are interested in
search_fields=c(&quot;ad_creation_time&quot;, 
                &quot;ad_delivery_start_time&quot;, 
                &quot;ad_delivery_stop_time&quot;,
                &quot;ad_creative_body&quot;,
                &quot;ad_creative_link_caption&quot;,
                &quot;ad_creative_link_description&quot;, 
                &quot;ad_creative_link_title&quot;, 
                &quot;ad_snapshot_url&quot;, 
                &quot;page_id&quot;,
                &quot;page_name&quot;,
                &quot;currency&quot;,
                &quot;spend&quot;,
                &quot;demographic_distribution&quot;,
                &quot;funding_entity&quot;,
                &quot;impressions&quot;,
                &quot;region_distribution&quot;) %&gt;% 
  stringr::str_c(., collapse=&quot;, &quot;)

page_one_response &lt;- GET(my_link,
                         path = &quot;/ads_archive&quot;,
                         query = list(access_token = my_token,
                                      limit=100,
                                      ad_active_status=&quot;ALL&quot;,
                                      search_terms=&quot;&#39;&#39;&quot;,
                                      fields=search_fields,
                                      ad_reached_countries=&quot;BE&quot;))
page_one_content&lt;- content(page_one_response)

result &lt;- tibble(data=page_one_content$data)

df_imp &lt;- result %&gt;% 
  tidyr::unnest_wider(data) 

#get the link refering to the next page
next_link &lt;- page_one_content$paging$`next`

#iterate over all pages until there is no further page
while(length(next_link)&gt;0) {
  next_response &lt;- GET(next_link)
  next_content&lt;- content(next_response)
  y &lt;- tibble(data=next_content$data)
  df_next &lt;- y %&gt;%
    unnest_wider(data) 
  df_imp &lt;- bind_rows(df_imp, df_next)  
  next_link &lt;- next_content$paging$`next`
}</code></pre>
<p>This returned 18K rows when I ran it 4 months ago. We are more than doubling the rows today, which is good news. It could have been that the archive only returned results on a rolling time window basis, but that does not seem to be the case, so more data to us.</p>
<p>We received 16 columns. Some of them contain lists.</p>
<pre class="r"><code>names(df_imp)</code></pre>
<pre><code>##  [1] &quot;ad_creation_time&quot;             &quot;ad_delivery_start_time&quot;      
##  [3] &quot;ad_creative_body&quot;             &quot;ad_snapshot_url&quot;             
##  [5] &quot;page_id&quot;                      &quot;page_name&quot;                   
##  [7] &quot;currency&quot;                     &quot;spend&quot;                       
##  [9] &quot;demographic_distribution&quot;     &quot;funding_entity&quot;              
## [11] &quot;impressions&quot;                  &quot;region_distribution&quot;         
## [13] &quot;ad_delivery_stop_time&quot;        &quot;ad_creative_link_caption&quot;    
## [15] &quot;ad_creative_link_title&quot;       &quot;ad_creative_link_description&quot;</code></pre>
<p>It will be easier if we have a custom function that extracts the date from the different time stamps.</p>
<pre class="r"><code>make_date &lt;- function(x){
  ymd(str_sub(x,1,10))
}

df_imp &lt;- df_imp %&gt;%
  mutate(ad_creation_day = make_date(ad_creation_time),
         ad_delivery_start_day = make_date(ad_delivery_start_time),
         ad_delivery_stop_day = make_date(ad_delivery_stop_time))</code></pre>
<p>The archive starts at:</p>
<pre class="r"><code>min(df_imp$ad_delivery_start_day)</code></pre>
<pre><code>## [1] &quot;2014-05-12&quot;</code></pre>
<p>And ends today:</p>
<pre class="r"><code>max(df_imp$ad_delivery_start_day)</code></pre>
<pre><code>## [1] &quot;2020-01-04&quot;</code></pre>
<p>But I suspect the number of ads of the ‘politics and issues’ category we obtained are not evenly spread between these two dates.</p>
<pre class="r"><code>df_imp %&gt;% 
  group_by(ad_delivery_start_day) %&gt;% 
  summarise(n_ads=n()) %&gt;%
  arrange(desc(n_ads)) %&gt;%
  ggplot()+
  geom_bar(aes(x= ad_delivery_start_day,
               y=n_ads
               ),
           #color=&quot;transparent&quot;,
           stat=&quot;identity&quot;
           )+
  theme_minimal()</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>So yes, very few until 2019, at least in the results we obtained with the api calls. This does not mean that there were not many in the past, it’s just the data we got given to work with.</p>
<p>The first dozens of ads were from the The European Democratic Party (EDP), the first ad from a Belgian political party started being delivered on 02/06/2017 and was from the N-VA:</p>
<pre class="r"><code>df_imp %&gt;% 
  filter(ad_delivery_start_day == ymd(&quot;2017-06-02&quot;)) %&gt;% 
  select(ad_delivery_start_day, ad_creative_body) %&gt;%
  slice(1) %&gt;% 
  datatable(class = &#39;compact&#39;, escape = TRUE, options = list(dom  = &#39;t&#39;))</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1"],["2017-06-02"],["Mét de N-VA eindelijk maatregelen tegen sociale-zekerheidstoerisme. De verandering werkt."]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ad_delivery_start_day<\/th>\n      <th>ad_creative_body<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<p>Glad to hear the change works, but I guess that means the end of going to Romania for my dental work.</p>
<p>Analyzing the global figures a bit further and getting the total ads per funding entity:</p>
<pre class="r"><code>df_imp %&gt;% 
  count(funding_entity,
        sort = TRUE,
        name = &quot;total ads&quot;)</code></pre>
<pre><code>## # A tibble: 940 x 2
##    funding_entity          `total ads`
##    &lt;chr&gt;                         &lt;int&gt;
##  1 &lt;NA&gt;                          16810
##  2 UNICEF Belgium                 1316
##  3 Vlaams Belang                  1083
##  4 PVDA                            955
##  5 Open Vld                        889
##  6 Greenpeace Belgium              784
##  7 Groen                           772
##  8 sp.a                            763
##  9 Nieuw-Vlaamse Alliantie         719
## 10 CD&amp;V                            622
## # ... with 930 more rows</code></pre>
<p>We learn that most of the ads have no funding entity and that there are more UNICEF ads than ads for the party “Vlaams Belang”.</p>
<p>It is indeed a pity that Facebook decided to put the ‘political’ and ‘issues’ categories in one bag. Furthermore, these categories are not based on the type of message, ad, but on the type of funding entity or page. This means that different rules apply on ‘issues’ entities and business entities.</p>
<p>In other words we have access to what Greenpeace Belgium is advertising in Belgium through Facebook, but not what Exxon Mobile is.</p>
<p><a href="https://www.facebook.com/ads/library/api/?source=archive-landing-page">Because</a> as stated by Facebook: “Default value:”POLITICAL_AND_ISSUE_ADS“:
The type of ad. We label either all returned ads as political or issue ads, or label ads for news related to politics or issues of political importance. See Facebook Ads Help Center, About ads related to politics or issues of national importance. We currently only support POLITICAL_AND_ISSUE_ADS.” Note that the options listed are: ALL, POLITICAL_AND_ISSUE_ADS, HOUSING_ADS, UNCATEGORIZED_ADS.</p>
<p>(I’m not really holding my breath for the housing adds.)</p>
<p>Facebook’s ads archive library is not only flawed, it is also biased because it does not include any corporate advertising. We might have a glimpse at what Belgian political parties spent and whatever their messages were, but we do not know how much was spent in Belgium flogging the F35 by Northrop Grumman for instance. And some commentators say that is exactly one of the reasons why Facebook is reluctant to be transparent. The more it is forced to be transparent on political ads and their impact on democracy, the more they will be under pressure to reveal the agenda of their corporate clients. As nicely explained in <a href="https://open.spotify.com/episode/09YkfvCUGsegLYgzMYrtvi?si=LniDF1c3QGezA9cmUERyfQ">this Guardian postcast</a></p>
<p>For now we have to do with what is given to us. Also with the fact that more than half of these ads have no known sponsors even though Facebook itself is <a href="https://www.facebook.com/business/help/208949576550051">claiming</a> “For general or national-level elections taking place in the European Union (such as the general election in Spain, the federal election in Belgium and the presidential election in Lithuania), political parties and candidates campaigning in these elections will be required to complete ad authorisations and place”Paid for by" disclaimers on all of their ads until the end of the election period."</p>
<p>Maybe the “Paid for by” appeared on all of their ads until the election period. Or they did not but here are the ads by unknown funding entity and by date in 2019:</p>
<pre class="r"><code>df_imp %&gt;% 
  filter(ad_creation_day &gt; ymd(&quot;2018-12-31&quot;)) %&gt;% 
  filter(is.na(funding_entity)) %&gt;% 
  group_by(ad_delivery_start_day) %&gt;% 
  summarise(n_ads=n()) %&gt;%
  arrange(desc(n_ads)) %&gt;%
  ggplot()+
  geom_bar(aes(x= ad_delivery_start_day,
               y=n_ads
               ),
           #color=&quot;transparent&quot;,
           stat=&quot;identity&quot;
           )+
  theme_minimal()</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>So we can safely say some of these ads were run during the election period, and it might be interesting to have a closer look at the ads without known funding entity, by looking at the page name they are financing.</p>
<pre class="r"><code>df_imp %&gt;% 
  filter(is.na(funding_entity)) %&gt;% 
  group_by(page_name) %&gt;% 
  summarise(count = n()) %&gt;%
  select(page_name, count) %&gt;% 
  arrange(desc(count))</code></pre>
<pre><code>## # A tibble: 3,396 x 2
##    page_name          count
##    &lt;chr&gt;              &lt;int&gt;
##  1 UNICEF Belgium       946
##  2 De Morgen            641
##  3 Kialo                484
##  4 Flamingos&#39; Life      408
##  5 Peter Mertens        322
##  6 Òmnium Cultural      221
##  7 Greenpeace Belgium   198
##  8 Slush                181
##  9 Pela Case            140
## 10 Pride Palace         136
## # ... with 3,386 more rows</code></pre>
<p>So here in the top ten, except for Mr. Mertens, there are no political actors. Only ‘issues’ like the UN agency UNICEF, a news outlet and others.</p>
<p>This means that if we want to create any meaningful analysis of political ads on Facebook for Belgium based on this data set there is not a small amount of data cleaning to be done. Tbh we are used to that, but not in a data set that would have have been specifically designed to be a basis for analysis.</p>
<p>Let’s try to only keep politicians and parties. But before we do we will have a look at the estimation of total expenses for Belgium in 2019, per page. We do not have exact numbers of amounts spent only a range per ad. Here are the ranges:</p>
<pre class="r"><code>sort(as.numeric(unique(unlist(df_imp$spend))))</code></pre>
<pre><code>##  [1]       0      99     100     199     200     299     300     399
##  [9]     400     499     500     599     600     699     700     799
## [17]     800     899     900     999    1000    1499    1500    1999
## [25]    2000    2499    2500    2999    3000    3499    3500    3999
## [33]    4000    4499    4500    4999    5000    5999    6000    6999
## [41]    8000    8999    9999   10000   14999   15000   19999   30000
## [49]   34999   35000   39999   49999   50000   60000   69999   99999
## [57]  100000  124999  199999  200000  249999  499999  500000  999999
## [65] 1000000</code></pre>
<p>These seem like amazing amounts, but I have not yet taken into account the currencies…</p>
<pre class="r"><code>df_imp %&gt;% 
  count(currency,
        sort = TRUE,
        name = &quot;total ads&quot;)</code></pre>
<pre><code>## # A tibble: 41 x 2
##    currency `total ads`
##    &lt;chr&gt;          &lt;int&gt;
##  1 EUR            32564
##  2 USD             4794
##  3 CAD              528
##  4 GBP              468
##  5 AUD              186
##  6 SEK              158
##  7 RUB               95
##  8 PLN               92
##  9 ILS               89
## 10 CHF               67
## # ... with 31 more rows</code></pre>
<p>Hmm 95 ads spent in rubles. That’s always interesting these days.</p>
<pre class="r"><code>rub &lt;- df_imp %&gt;% 
  filter(currency == &quot;RUB&quot;)</code></pre>
<p>The set contains an infamous scam messages but also some anti-China and anti-US messages from the Russian International Affairs Council:</p>
<pre class="r"><code>rub %&gt;% 
  select(page_name, ad_creative_body) %&gt;% 
  slice(79:80) %&gt;% 
  mutate(ad_creative_body = substr(ad_creative_body, 1, 750)) %&gt;% 
  datatable(class = &#39;compact&#39;, escape = TRUE, options = list(dom  = &#39;t&#39;))</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["1","2"],["Russian International Affairs Council","Russian International Affairs Council"],["The abrupt withdrawal of U.S. forces from Afghanistan could destabilize the situation, leading to the failure of any peace initiatives, a new round of war between intra-Afghan forces and, ultimately, the transition of Kabul under the control of radicals. \nSuch a scenario could lead to the further radicalization of the situation and entail the moving of the crisis zone beyond the political and geographical borders of Afghanistan. This makes the Central Asian States vulnerable. For this reason, Russia continues to strengthen its cooperation with the Central Asian region countries. \n\nEscape from Responsibility: the U.S. Is Looking for a Way Out of Afghanistan, by Руслан Мамедов (Ruslan Mamedov)","General Secretary of China Xi Jinping’s tour of Italy, Monaco and France on March 21–26, 2019, caused a stir across Europe. What approach should be taken to projects being proposed under the Belt and Road Initiative? What threats are posed by China’s penetration into the EU economy? What foreign economic policy should be pursued in the current trade and economic confrontation between the United States and China? These and similar issues have been discussed by European leaders for years, and now, with Xi Jinping’s latest visit, the debates have taken on a new significance. While Brussels and Berlin are more concerned about maintaining competitiveness with China, Rome only added fuel to the fire, becoming the first EU founding country to join"]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>page_name<\/th>\n      <th>ad_creative_body<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<p>Russia critising a possible withdrawal of US troops from Afghanistan is such a 2019 thing to do.</p>
<p>And the set of ads paid in rubles also contains what looks to be ads against Bart De Wever (the president of the N-VA), or click-bait, by these pages:</p>
<pre class="r"><code>rub &lt;- rub %&gt;%
  filter(str_detect(ad_creative_body, &quot;Wever&quot;)) %&gt;%
  select(page_name, ad_creative_body, ad_creative_link_description)%&gt;%
  unique() %&gt;%
  head(4) %&gt;%
  datatable(rownames = TRUE, class = &#39;compact&#39;, escape = TRUE, options = list(dom  = &#39;t&#39;))</code></pre>
<hr />
<p>Rather weird. But it might be more interesting to see what ads had the biggest budgets. We need to convert to a common currency to compare the amounts spent. Let us get today’s exchange rates to the euro of the currencies in our data frame.</p>
<pre class="r"><code>library(quantmod)
from &lt;- unique(df_imp$currency)
to &lt;- c(&quot;EUR&quot;)
rates &lt;- getQuote(paste0(from, to, &quot;=X&quot;)) %&gt;% 
  rownames_to_column() %&gt;% 
  mutate(currency = substr(rowname,1,3)) %&gt;% 
  select(currency, Last) </code></pre>
<pre class="r"><code>head(rates)</code></pre>
<pre><code>##   currency      Last
## 1      EUR 1.0000000
## 2      USD 0.8962000
## 3      CHF 0.9201000
## 4      ILS 0.2568400
## 5      KRW 0.0007687
## 6      PHP 0.0174800</code></pre>
<p>In order to estimate the amount spent per ad we will take the value in the middle of the spent range.</p>
<pre class="r"><code>df_spent &lt;- unnest_wider(df_imp, spend)
df_spent &lt;- df_spent %&gt;%
  mutate(spent = as.numeric(lower_bound)+(as.numeric(upper_bound)-as.numeric(lower_bound)+1)/2)
df_spent &lt;- df_spent %&gt;% 
  left_join(rates) %&gt;% 
  mutate(euro = spent*Last)

df_spent %&gt;% group_by(page_name) %&gt;% 
  summarise(sum = sum(euro)) %&gt;% 
  arrange(desc(sum))</code></pre>
<pre><code>## # A tibble: 4,152 x 2
##    page_name                sum
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Vlaams Belang       1119900 
##  2 European Parliament  856800 
##  3 Tom Van Grieken      481050 
##  4 Kialo                404276.
##  5 Pela Case            372252.
##  6 N-VA                 353700 
##  7 Open Vld             245600 
##  8 sp.a                 194500 
##  9 Chilly&#39;s Bottles     181574.
## 10 UNICEF Belgium       176850 
## # ... with 4,142 more rows</code></pre>
<p>So the Vlaams Belang takes first and second place, bearing in mind that the European Parliament spreads its ads over a much wider range of regions (hundreds, and there are three in Belgium).</p>
<p>And here is an estimation of what was spent in rubles on these De Wever ads:</p>
<pre class="r"><code>df_spent %&gt;%
  filter(currency == &quot;RUB&quot;) %&gt;% 
  filter(str_detect(ad_creative_body, &quot;Wever&quot;)) %&gt;%
  select(euro) %&gt;% 
  sum()</code></pre>
<pre><code>## [1] 5850.191</code></pre>
<p>6K€ is not that much compared to the others, but too much to be a mere prank.</p>
<p>What was the reach of these ads/pages? Or rather we have a range of impressions per ad (the number of times the content was displayed to a target audience).</p>
<pre class="r"><code>df_reach &lt;- df_spent %&gt;%
  rename(lower_spent = lower_bound) %&gt;% 
  rename(upper_spent = upper_bound) %&gt;% 
  unnest_wider(impressions) %&gt;% 
   mutate(impres = as.numeric(lower_bound)
          +(as.numeric(upper_bound)
            -as.numeric(lower_bound)+1)/2)</code></pre>
<pre class="r"><code>df_reach %&gt;% filter(!is.na(impres)) %&gt;% 
  group_by(page_name) %&gt;% 
  summarise(sum = sum(impres)) %&gt;% 
  arrange(desc(sum)) </code></pre>
<pre><code>## # A tibble: 4,123 x 2
##    page_name                sum
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 Vlaams Belang       77906500
##  2 European Parliament 56080000
##  3 N-VA                47783500
##  4 sp.a                47145500
##  5 Kialo               44492000
##  6 Tom Van Grieken     43127500
##  7 Open Vld            31558000
##  8 European Commission 29422500
##  9 CD&amp;V                23997000
## 10 PTB                 23460500
## # ... with 4,113 more rows</code></pre>
<p>This means that the ads of the N-VA and sp.a have had a bigger number of impressions than the page of Tom Van Grieken, despite having spent less money on them. Having said that reach and clicks are also important metrics to evaluate marketing impact, but we just do not have that data.</p>
<p>Next to ‘issue’ pages there are also businesses in the list, like for instance Garnier. They cannot really be categorised as an issue organisation.</p>
<pre class="r"><code>df_reach %&gt;% 
  filter(page_name == &quot;Garnier&quot;) %&gt;% 
  select(ad_creative_body) %&gt;% 
  filter(str_detect(ad_creative_body, &quot;luchtvervuiling!|Pollution&quot;)) %&gt;% 
  datatable(class = &#39;compact&#39;, escape = TRUE, options = list(dom  = &#39;t&#39;))</code></pre>
<p><div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","data":[["1","2"],["Bye bye sporen van luchtvervuiling! Veeg onzuiverheden weg in slechts één beweging met het Micellair Water van Garnier. 👋","Pollution urbaine ? STOP ! EN un geste, ballayez toute trace d'impureté avec l'Eau Micellaire Garnier. 👋"]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ad_creative_body<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script><!Unless of course you see selling their water solution for wiping pollution from your face as an environmental cause…</p>
<p>One strategy to get only the political actors is to filter on the pages or funding entities that have a political party name in them. But some politicians do not mention in their page name for which party they are a candidate for. So all the candidates names are also needed.</p>
<p>Let’s do some scraping from an official election site.</p>
<pre class="r"><code>url &lt;- paste0(&quot;https://elections2019.belgium.be/en/candidates?title=&amp;field_election&quot;,
              &quot;_id_value=&amp;field_party_name_value=&amp;order=field_party_name&amp;sort=asc&amp;page=0&quot;)

candidates &lt;- data.frame()
selector &lt;- paste0(&quot;body &gt; div &gt; main &gt; div &gt; div &gt; section &gt; div &gt; div.views&quot;,
                   &quot;-element-container.form-group &gt; div &gt; div.view-content &gt; div &gt; table&quot;)

for(i in (0:138)){
  print(i)
  url &lt;- glue(&quot;https://elections2019.belgium.be/en/candidates?field_election_id_value&quot;,
              &quot;=&amp;field_party_name_value=&amp;title=&amp;page={i}&quot;)
  table &lt;- url %&gt;% 
  read_html() %&gt;% 
  html_node(selector) %&gt;% 
  html_table()
  
  candidates &lt;- rbind(candidates, table)

}</code></pre>
<pre class="r"><code>candidates %&gt;%
  select(Name) %&gt;% 
  unique() %&gt;%
  nrow()</code></pre>
<pre><code>## [1] 6894</code></pre>
<p>So almost 7 thousand candidates in</p>
<pre class="r"><code>candidates %&gt;%
  select(Party) %&gt;% 
  unique() %&gt;%
  nrow()</code></pre>
<pre><code>## [1] 60</code></pre>
<p>60 parties.</p>
<p>We can start with the candidates, but then we need to construct a key to join the Facebook data with the candidates table. We will only use the sorted letters (without accents) of their first and last names.</p>
<pre class="r"><code>str_sort &lt;- function(x)
  sapply(lapply(strsplit(x, NULL), sort), paste, collapse=&quot;&quot;)

candidates &lt;- candidates %&gt;%
  mutate(clean_name = str_replace_all(Name,&quot;[^[:alnum:][:blank:]?&amp;/\\-]&quot;, &quot;&quot;)) %&gt;%
  mutate(clean_name = tolower(str_replace_all(clean_name,&quot;-&quot;, &quot;&quot;))) %&gt;% 
  mutate(clean_name = stri_trans_general(clean_name, id = &quot;Latin-ASCII&quot;)) %&gt;%
  mutate(clean_name = str_replace_all(clean_name,&quot; &quot;,&quot;&quot;))%&gt;% 
  mutate(key = str_sort(clean_name)) %&gt;% 
  select(-clean_name)

df_candidates &lt;- df_reach %&gt;%
  mutate(clean_name = str_replace_all(page_name,&quot;[^[:alnum:][:blank:]?&amp;/\\-]&quot;, &quot;&quot;)) %&gt;%
  mutate(clean_name = tolower(str_replace_all(clean_name,&quot;-&quot;, &quot;&quot;))) %&gt;% 
  mutate(clean_name = stri_trans_general(clean_name, id = &quot;Latin-ASCII&quot;)) %&gt;%
  mutate(clean_name = str_replace_all(clean_name,&quot; &quot;,&quot;&quot;))%&gt;% 
  mutate(key = str_sort(clean_name)) %&gt;% 
  select(-clean_name)

df_candidates &lt;- df_candidates %&gt;% 
  inner_join(candidates)

df_candidates  %&gt;% 
  count(page_name,
        sort = TRUE,
        name = &quot;total ads&quot;)</code></pre>
<pre><code>## # A tibble: 541 x 2
##    page_name             `total ads`
##    &lt;chr&gt;                       &lt;int&gt;
##  1 Peter Mertens                 844
##  2 Tom Van Grieken               354
##  3 Brecht Warnez                 336
##  4 Maurits Vande Reyde           283
##  5 Tom Vandendriessche           209
##  6 Jos D&#39;Haese                   174
##  7 Georges-Louis Bouchez         144
##  8 Kathleen Van Brempt           144
##  9 Hendrik Bogaert               133
## 10 John Crombez                  119
## # ... with 531 more rows</code></pre>
<p>And do some candidates names appear as funding entities for pages?</p>
<pre class="r"><code>df_candidates_f &lt;- df_reach %&gt;%
  filter(!page_name %in% df_candidates$page_name) %&gt;% 
  mutate(clean_name = str_replace_all(funding_entity,&quot;[^[:alnum:][:blank:]?&amp;/\\-]&quot;, &quot;&quot;)) %&gt;%
  mutate(clean_name = tolower(str_replace_all(clean_name,&quot;-&quot;, &quot;&quot;))) %&gt;% 
  mutate(clean_name = stri_trans_general(clean_name, id = &quot;Latin-ASCII&quot;)) %&gt;%
  mutate(clean_name = str_replace_all(clean_name,&quot; &quot;,&quot;&quot;))%&gt;% 
  mutate(key = str_sort(clean_name)) %&gt;% 
  select(-clean_name)

df_candidates_f &lt;- df_candidates_f %&gt;% 
  inner_join(candidates)</code></pre>
<pre><code>## Joining, by = &quot;key&quot;</code></pre>
<pre class="r"><code>df_candidates_f %&gt;% 
  count(page_name, funding_entity,
        sort = TRUE,
        name = &quot;total ads&quot;)</code></pre>
<pre><code>## # A tibble: 43 x 3
##    page_name                                 funding_entity     `total ads`
##    &lt;chr&gt;                                     &lt;chr&gt;                    &lt;int&gt;
##  1 Be.One                                    Abou Jahjah Dyab            58
##  2 Groen West-Vlaanderen                     Sabels Jordy                21
##  3 sp.a Hemiksem - Waa zien H geire          Talboom Rodney              21
##  4 Didrik - 48e candidat à la Région de Bru~ Didrik de Schaetz~          18
##  5 Dirk Rochtus, N-VA Grobbendonk-Bouwel     Dirk Rochtus                16
##  6 Alexandra Philippe - DéFI                 Alexandra Philippe          11
##  7 Ieper2050                                 Sabels Jordy                 7
##  8 Martin Maréchal PS                        Martin Maréchal              7
##  9 Nicolas Stilmant - 2e effectif - liste C~ Nicolas Stilmant             7
## 10 Simon De Boeck - 1e schepen Gooik         De Boeck Simon               7
## # ... with 33 more rows</code></pre>
<pre class="r"><code>df_candidates &lt;- df_candidates %&gt;% 
  rbind(df_candidates_f) %&gt;% 
  filter(page_name !=&quot;Tekos&quot;)</code></pre>
<p>Now using party names to identify page names and funding entities.</p>
<pre class="r"><code>parties &lt;- candidates %&gt;% 
  select(Party) %&gt;% 
  mutate(name = tolower(Party)) %&gt;% 
  select(-Party) %&gt;% 
  unique()

parties &lt;- c(parties,&quot;one brussels&quot;) # adding

extract_party &lt;- function(x){
  x &lt;- unlist(tokenize_ngrams(x, lowercase = TRUE, n = 3L, n_min = 1,
                stopwords = character(), ngram_delim = &quot; &quot;, simplify = FALSE))
  first(parties$name[parties$name %in% x])
  }

df_parties &lt;- df_reach %&gt;%
  filter(!page_name %in% df_candidates$page_name)
  
df_parties$name_party &lt;- map(tolower(df_parties$page_name), extract_party)

df_parties %&gt;%
  count(unlist(name_party),
        sort = TRUE,
        name = &quot;total ads&quot;)</code></pre>
<pre><code>## # A tibble: 30 x 2
##    `unlist(name_party)` `total ads`
##    &lt;chr&gt;                      &lt;int&gt;
##  1 &lt;NA&gt;                       25115
##  2 open vld                     995
##  3 groen                        992
##  4 vlaams belang                986
##  5 sp.a                         944
##  6 cdh                          582
##  7 mr                           428
##  8 défi                         306
##  9 ps                           261
## 10 ecolo                        252
## # ... with 20 more rows</code></pre>
<pre class="r"><code># there was a problem treating the &amp; and - in cd&amp;v and n-va

additional_parties &lt;- df_reach %&gt;%
  filter(!page_name%in% df_candidates$page_name) %&gt;% 
  mutate(name_party = tolower(str_extract(page_name, &quot;N-VA|CD&amp;V&quot;))) %&gt;% 
  filter(!is.na(name_party))

df_parties &lt;- rbind(df_parties, additional_parties)</code></pre>
<p>And for the party names in the funding entity names.</p>
<pre class="r"><code>df_parties_f &lt;- df_reach %&gt;%
  filter(!page_name %in% df_candidates$page_name)
  
df_parties_f$name_party &lt;- map(tolower(df_parties_f$funding_entity), extract_party)

df_parties &lt;- df_parties %&gt;% 
  filter(!is.na(name_party)) %&gt;% 
  rbind(df_parties_f %&gt;% 
          filter((!is.na(name_party))))

# there was a problem treating the &amp; and - in cd&amp;v and n-va

additional_parties_f &lt;- df_reach %&gt;%
  filter(!page_name%in% df_candidates$page_name) %&gt;% 
  mutate(name_party = tolower(str_extract(funding_entity, &quot;N-VA|CD&amp;V&quot;))) %&gt;% 
  filter(!is.na(name_party))

df_parties &lt;- rbind(df_parties, additional_parties_f)</code></pre>
<p>We still missed a few pages, but they do not represent a lot of ads.</p>
<pre class="r"><code>more &lt;- c(&quot;Jean-Claude Marcourt - Officiel&quot;, &quot;Patrick Cottenie&quot;,
          &quot;Guillaume Soupart - Conseiller communal&quot;, 
          &quot;Cédric Mahieu - Conseiller communal à 1030&quot;, 
          &quot;Hannes De Reu&quot;, &quot;Alexander Vandersmissen&quot; ,
          &quot;Marie Arena&quot;,&quot;Luc Haegemans&quot;, &quot;Michael Freilich - Kamerlid&quot;, 
          &quot;Christophe Leurident&quot;, 
          &quot;Lara Thommès - Conseillère communale à Ganshoren&quot;, 
          &quot;Kevin Engelen&quot;,&quot;Marie Meunier&quot;, 
          &quot;Thomas Van Hoof&quot;)


df_add_ref &lt;- data.frame(&quot;page_name&quot; = more, &quot;name_party&quot; = c(&quot;ps&quot;,&quot;nv-a&quot;,&quot;mr&quot;,&quot;cdh&quot;,&quot;sp.a&quot;,
                                                          &quot;open vld&quot;,&quot;ps&quot;,&quot;cd&amp;v&quot;,
                                                          &quot;nv-a&quot;,&quot;mr&quot;,&quot;ps&quot;,&quot;nv-a&quot;,
                                                          &quot;ps&quot;,&quot;n-va&quot;))

df_add &lt;- df_reach %&gt;% 
  filter(page_name %in% more) %&gt;% 
  left_join(df_add_ref)

df_parties &lt;- df_parties %&gt;% 
  rbind(df_add) %&gt;% 
  unique()</code></pre>
<p>There is a data frame based on the candidates, and another one based on the parties. Time to put them together. And we will be focusing on 2019.</p>
<pre class="r"><code>df_candidates &lt;- df_candidates %&gt;% 
  mutate(name_party = tolower(Party))

df &lt;- df_parties %&gt;% 
  rbind(df_candidates %&gt;%
          select(-one_of(setdiff(names(df_candidates), names(df_parties))))) %&gt;% 
  filter(page_name != &quot;Mr. Gugu &amp; Miss Go&quot;)

df &lt;- df %&gt;% 
  mutate(name_party = unlist(name_party)) %&gt;% 
  filter(ad_creation_day &gt; ymd(&quot;2018-12-31&quot;)) %&gt;% 
  filter(ad_creation_day &lt; ymd(&quot;2020-01-01&quot;))

df %&gt;% 
   count(name_party,
        sort = TRUE,
        name = &quot;total_ads&quot;)</code></pre>
<pre><code>## # A tibble: 35 x 2
##    name_party    total_ads
##    &lt;chr&gt;             &lt;int&gt;
##  1 cd&amp;v               2328
##  2 sp.a               1874
##  3 open vld           1861
##  4 vlaams belang      1841
##  5 n-va               1481
##  6 pvda               1371
##  7 groen              1172
##  8 mr                  989
##  9 cdh                 707
## 10 ps                  700
## # ... with 25 more rows</code></pre>
<p>Here we define the parties colors and we count the number of ads per party:</p>
<pre class="r"><code>colors &lt;- c(&quot;n-va&quot;= &quot;sienna3&quot;,
            &quot;vlaams belang&quot; = &quot;grey35&quot;,
            &quot;groen&quot; = &quot;lightgreen&quot;,
            &quot;open vld&quot; = &quot;deepskyblue&quot;,
            &quot;cdh&quot; = &quot;darkorange2&quot;,
            &quot;ps&quot; = &quot;hotpink2&quot;,
            &quot;sp.a&quot; = &quot;pink&quot;,
            &quot;pvda&quot; =&quot;firebrick2&quot;,
            &quot;ptb&quot; = &quot;firebrick2&quot;,
            &quot;cd&amp;v&quot; = &quot;orange&quot;,
            &quot;ecolo&quot; = &quot;lightgreen&quot;,
            &quot;défi&quot; = &quot;#ca2c92&quot;,
            &quot;mr&quot; = &quot;royalblue&quot;)


df %&gt;% 
  group_by(name_party) %&gt;% 
  summarise(n_ads=n()) %&gt;%
  arrange(desc(n_ads)) %&gt;%
  filter(n_ads &gt; 200) %&gt;% 
  ggplot() +
  geom_bar(aes(x=reorder(name_party, n_ads),
               y=n_ads,
               fill= name_party),
           color=&quot;transparent&quot;,
           stat=&quot;identity&quot;,
           width = 0.7) +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, y = &quot;#ads&quot;) +
  theme(axis.text.x = element_text(angle = 45, hjust = 0.95)) +
  scale_fill_manual(&quot;name_party&quot;, values=colors)</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p>Doing the same but now looking at the amounts spent:</p>
<pre class="r"><code>euro_format &lt;- function(largest_with_cents = 100000) {
  function(x) {
    x &lt;- plyr::round_any(x, 0.01)
    if (max(x, na.rm = TRUE) &lt; largest_with_cents &amp;
        !all(x == floor(x), na.rm = TRUE)) {
      nsmall &lt;- 2L
    } else {
      x &lt;- plyr::round_any(x, 1)
      nsmall &lt;- 0L
    }
    str_c(&quot;€&quot;, format(x, nsmall = nsmall, trim = TRUE, big.mark = &quot;.&quot;, 
                      scientific = FALSE, digits=1L))
  }
}


df %&gt;% 
  group_by(name_party) %&gt;% 
  summarise(euro =sum(euro)) %&gt;%
  arrange(desc(euro)) %&gt;%
    filter(euro &gt; 60000) %&gt;% 
  ggplot() +
  geom_bar(aes(x=reorder(name_party, euro),
               y=euro,
               fill= name_party),
           color=&quot;transparent&quot;,
           stat=&quot;identity&quot;,
           width = 0.7) +
  theme_minimal() +
  theme(legend.position = &quot;none&quot;) +
  labs(x = &quot;&quot;, y = &quot;&quot;) +
  #theme(axis.text.x = element_text(angle = 45, hjust = 0.70)) +
  scale_fill_manual(&quot;name_party&quot;, values=colors)+
  theme(plot.margin=unit(c(.75,.75,0,1,1),&quot;cm&quot;))+
  ylim(0, 2100000)+
  coord_flip()+
  scale_y_continuous(labels=euro_format())</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<pre class="r"><code>#top, then right, bottom and left</code></pre>
<p>The Vlaams Belang appears to be spending more than three times more than the second biggest spender, the N-VA.</p>
<pre class="r"><code>(df %&gt;% filter(name_party==&quot;vlaams belang&quot;) %&gt;% 
                 filter(year(ymd(ad_creation_day))==2019) %&gt;% 
   select(euro) %&gt;% 
   sum)/
sum(df$euro)</code></pre>
<pre><code>## [1] 0.4169943</code></pre>
<p>And their spending represents 42% of the total spending we identified in 2019.</p>
<p>This is the way the number of ads were spread out during the year by biggest advertisers:</p>
<pre class="r"><code>biggest &lt;- df %&gt;%
  filter(ad_delivery_start_day &gt; ymd(&quot;2018-12-31&quot;)) %&gt;% 
  group_by(name_party) %&gt;% 
  summarise(n_ads=n()) %&gt;%
  arrange(desc(n_ads)) %&gt;% 
  slice(1:10)


df %&gt;% 
  filter(ad_delivery_start_day &gt; ymd(&quot;2018-12-31&quot;)) %&gt;% 
  mutate(week = week(ad_creation_day)) %&gt;% 
  filter(name_party %in% biggest$name_party) %&gt;%
  #group_by(name_party, ad_delivery_start_day) %&gt;%
  group_by(name_party, week) %&gt;% 
  summarise(n_ads=n()) %&gt;%
  arrange(desc(n_ads)) %&gt;%
  ggplot()+
  theme_minimal() +
  labs(x = &quot;party&quot;, y = &quot;#ads&quot;) +
  geom_bar(aes(x= week,
               y=n_ads,
               fill = name_party),
           color=&quot;transparent&quot;,
           stat=&quot;identity&quot;,
           width = 0.7)+
  scale_fill_manual(&quot;party&quot;, values=colors)</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<pre class="r"><code># df %&gt;% 
#   group_by(ad_creative_body, page_name) %&gt;% 
#   summarise(euro = sum(spent)) %&gt;%
#   arrange(desc(euro)) %&gt;%
#   head(5) %&gt;% 
#   datatable()</code></pre>
<p>And by amounts spent:</p>
<pre class="r"><code>df %&gt;% 
  filter(ad_delivery_start_day &gt; ymd(&quot;2018-12-31&quot;)) %&gt;% 
  mutate(week = week(ad_creation_day)) %&gt;% 
  filter(name_party %in% biggest$name_party) %&gt;%
  #group_by(name_party, ad_delivery_start_day) %&gt;%
  group_by(name_party, week) %&gt;% 
  summarise(euro=sum(euro)) %&gt;%
  arrange(desc(euro)) %&gt;%
  ggplot()+
  theme_minimal() +
  labs(x = &quot;party&quot;, y = &quot;&quot;) +
  geom_bar(aes(x= week,
               y=euro,
               fill = name_party),
           color=&quot;transparent&quot;,
           stat=&quot;identity&quot;,
           width = 0.7)+
  scale_fill_manual(&quot;party&quot;, values=colors)+
  scale_y_continuous(labels=euro_format())</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>It also seems that the Vlaams Belang was the party that bought the most ads after the elections. Let’s have a closer look:</p>
<pre class="r"><code>df %&gt;% 
  filter(ad_creation_day &gt; ymd(&quot;2019-05-31&quot;)) %&gt;% 
  mutate(week = week(ad_creation_day)) %&gt;% 
  filter(name_party %in% biggest$name_party) %&gt;%
  #group_by(name_party, ad_delivery_start_day) %&gt;%
  group_by(name_party, week) %&gt;% 
  summarise(euro=sum(euro)) %&gt;%
  arrange(desc(euro)) %&gt;%
  ggplot()+
  theme_minimal() +
  labs(x = &quot;party&quot;, y = &quot;&quot;) +
  geom_bar(aes(x= week,
               y=euro,
               fill = name_party),
           color=&quot;transparent&quot;,
           stat=&quot;identity&quot;,
           width = 0.7)+
  scale_fill_manual(&quot;party&quot;, values=colors)+
  scale_y_continuous(labels=euro_format())</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>We can see there is more diversity after week 39.</p>
<p>There are also some demo-graphical data at hand. And they need to be extracted from a column. Here under with a bit of a slow loop but I have to go and run errands anyway.</p>
<pre class="r"><code>df_demog &lt;- data_frame()
for (i in (1:nrow(df))){
  print(i)
  x &lt;- df[i,]
  y &lt;- unnest(x, demographic_distribution)
  add_df &lt;- data_frame()
  for (j in (1:nrow(y))){
    row &lt;- data.frame(as.list(y$demographic_distribution[j]))
    add_df &lt;- rbind(add_df, row)
  }
  y &lt;- cbind(y, add_df)
  df_demog &lt;- rbind(df_demog, y)
}</code></pre>
<p>Let’s what we have and what categories the parties target the most:</p>
<pre class="r"><code>#saveRDS(df_demog, &quot;./data/20200104/df_demog.rds&quot;)
df_demog &lt;- readRDS(&quot;./data/20200104/df_demog.rds&quot;)

df_demog &lt;- df_demog %&gt;% 
  mutate(percentage = as.numeric(as.character(percentage))) %&gt;% 
  mutate(spent_demog = euro*percentage)

line_df &lt;- df_demog %&gt;% 
  select(name_party, age, gender, spent_demog) %&gt;% 
  group_by(name_party, age, gender) %&gt;% 
  summarise(spent = sum(spent_demog)) %&gt;% 
  ungroup()


top_spenders &lt;- line_df %&gt;% group_by(name_party) %&gt;% 
  summarise(budget = sum(spent)) %&gt;% 
  arrange(desc(budget)) %&gt;% 
  head(9) </code></pre>
<pre class="r"><code>line_df %&gt;% left_join(top_spenders) %&gt;% 
  mutate(prct = spent/budget) %&gt;% 
  filter(name_party %in% top_spenders$name_party) %&gt;%
  filter(age != &quot;13-17&quot;) %&gt;%
  filter(gender != &quot;unknown&quot;) %&gt;% 
  mutate(order  = as.numeric(substr(age,1,2))) %&gt;% 
  arrange(order) %&gt;% 
  ggplot(aes(x= reorder(age, order), y=prct, group=gender, color=gender)) +
  geom_line()+
  scale_color_manual(values=c(&quot;#CC6666&quot;, &quot;#9999CC&quot;))+
  facet_wrap(~name_party, scales = &quot;fixed&quot;)+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90))+
  xlab(&quot;age bins&quot;)+
  ylab(&quot;percentage spent&quot;)+
  scale_y_continuous(labels=percent_format(accuracy=1))</code></pre>
<p><img src="/post/2020-01-04-political-ads-on-facebook-for-the-2019-belgian-elections_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>The data can be further subsetted by one of the three Belgian regions but that is where it ends. Facebook is not transparent enough to present the categories that are used to micro target political messages. And that is an important missing element.</p>
<p>As Jason Kint put in a tweet:</p>
<center>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
<a href="https://twitter.com/kevin_purcell"><span class="citation">@kevin_purcell</span></a> Please feel free to try (click the menu Embed Tweet here) and let me know if it does not work.
</p>
— Yihui Xie (<span class="citation">@xieyihui</span>) <a href="https://twitter.com/jason_kint/status/1213678664740753409">Jan 5, 2016</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>If accurate at all we can only infer some general trends from what we obtained.</p>
<p>In a future post I will be analysing the ad texts themselves. Let’s see what we can learn from those!</p>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/post/topic-modeling-beer-reviews/">Topic modeling beer reviews</a></li>
	
	<li><a href="/post/tf-idf-and-beer-reviews/">tf_idf and beer reviews</a></li>
	
	<li><a href="/post/beer-reviews-galore/">Beer reviews galore!</a></li>
	
	<li><a href="/post/analysing-belgian-politics-with-wikipedia/">Analysing Belgian Politics with Wikipedia</a></li>
	
	<li><a href="/post/members-of-the-chamber-of-representatives-of-belgium-55th-legistlature-in-pictures/">members of the chamber of representatives of Belgium, 55th legistlature, in pictures</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>


<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
  
    <div id="show_comments"><a id="load_comments" class="button is-link">Load comments</a></div>
  
    <script type="text/javascript">
      var disqus_shortname = 'bad-to-the-code';
      function disqus() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }
  
      
      var hash = window.location.hash.substr(1);
      if ((hash.length > 8) && (hash.substring(0, 8) === "comment-")) {
        disqus();
        document.getElementById("show_comments").style.display = "none";
      } else {
        document.getElementById('load_comments').onclick = function() {
          disqus();
          document.getElementById("show_comments").style.display = "none";
        };
      }
  

    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/madcap1090">William Bourgeois</a> 2019</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-137981534-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/matomo.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>
  <img src="//matomo.example.com/piwik.php?idsite=1&amp;rec=1" style="border:0" alt="" />
</noscript>


</body>
</html>

