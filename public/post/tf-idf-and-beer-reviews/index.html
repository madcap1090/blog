<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>tf_idf and beer reviews | bad to the code</title>

<meta property='og:title' content='tf_idf and beer reviews - bad to the code'>
<meta property='og:description' content='We have our data now, we scraped it from the web like we showed here. How can we best start looking at the data?
Maybe best by a tf-idf analysis? I like it because it is simple, but at the same time gives valuable insights both into the structure of the data (words by category) and the content (differences between categories of texts, whatever you might decide these categories to be)'>
<meta property='og:url' content='/post/tf-idf-and-beer-reviews/'>
<meta property='og:site_name' content='bad to the code'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/5f460ebf37e30791f47bb5be3de73e3a?s=256'><meta property='article:author' content='https://facebook.com/OClassicoOficial/videos/391802167961744/'><meta property='article:section' content='Post'><meta property='article:tag' content='Beers'><meta property='article:tag' content='nlp'><meta property='article:tag' content='language detection'><meta property='article:published_time' content='2019-11-17T00:00:00Z'/><meta property='article:modified_time' content='2019-11-17T00:00:00Z'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@WilliamBourgeoi'><meta name='twitter:creator' content='@WilliamBourgeoi'>


<link href="/index.xml" rel="alternate" type="application/rss+xml" title="bad to the code" />

<link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="/">
          <h1 class="title is-4">bad to the code</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="facebook" href='https://facebook.com/OClassicoOficial/videos/391802167961744/'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:madcap1090@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/williambourgeois'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="twitter" href='https://twitter.com/WilliamBourgeoi'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/madcap1090'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/tags/beers">#Beers</a>



  
  | <a class="subtitle is-6" href="/tags/nlp">#nlp</a>
  
  | <a class="subtitle is-6" href="/tags/language-detection">#language detection</a>
  

      
    </div>
    <h2 class="subtitle is-6">November 17, 2019</h2>
    <h1 class="title">tf_idf and beer reviews</h1>
    
    <div class="content">
      
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>
<script src="/rmarkdown-libs/typedarray/typedarray.min.js"></script>
<link href="/rmarkdown-libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotly-main/plotly-latest.min.js"></script>


<p>We have our data now, we scraped it from the web like we showed <a href="https://badtothecode.netlify.com/post/beer-reviews-galore/">here</a>. How can we best start looking at the data?</p>
<p>Maybe best by a tf-idf analysis? I like it because it is simple, but at the same time gives valuable insights both into the structure of the data (words by category) and the content (differences between categories of texts, whatever you might decide these categories to be)</p>
<p>For every word in every ‘category’ it calculates the term frequency against the inverse document frequency. More <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">here</a>.</p>
<pre class="r"><code>library(&quot;tidyverse&quot;)
library(&quot;tidytext&quot;) # install.packages(&quot;tidytext&quot;)
library(&quot;cld2&quot;)
library(&quot;cld3&quot;) #install.packages(&quot;cld3&quot;)
library(&quot;DT&quot;)
library(&quot;ggrepel&quot;)
library(&quot;plotly&quot;)
library(&quot;viridis&quot;)</code></pre>
<p>After attaching the libraries and loading the data, we can create a function that will clean the reviews and delete some words that directly link to the beer category and that therefore they do not add any information.</p>
<pre class="r"><code>input &lt;- readRDS(&quot;./data/20191113/output_final_cleaned.rds&quot;)

treat_comment &lt;- function(text){
  text &lt;- paste(unlist(text), collapse = &quot;&quot;) 
  text &lt;- gsub(&quot;characters&quot;, &quot;characters &quot;, text)
  text &lt;- gsub(&#39;[[:digit:]]+&#39;,&#39; &#39;,text)
  text &lt;- gsub(&#39;[[:punct:]]+&#39;,&#39; &#39;,text)
  text &lt;- gsub(&#39;[^[:alpha:]]+&#39;,&#39; &#39;,text)
  text &lt;- gsub(&#39;[^[:alpha:]]+&#39;,&#39; &#39;,text)
  text &lt;- tolower(text)
  text &lt;- gsub(&quot;belgian&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;lambic&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;quad&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;strong dark&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;strong pale&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;tripel&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;bspa&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;bsda&quot;,&#39; &#39;, text)
  text &lt;- gsub(&quot;bspas&quot;,&#39; &#39;, text)
  text &lt;- gsub(&#39;rdev look smell taste feel overall&#39;,&quot; &quot;,text)
  return(text)
}</code></pre>
<p>Let’s see a review #18 as a sample off a treated review.</p>
<pre class="r"><code>input %&gt;% select(i, comments) %&gt;% 
  slice(18) %&gt;% 
  mutate(comments = substr(treat_comment(comments),1,1500)) %&gt;% 
  datatable(rownames = FALSE,  options = list(dom  = &#39;t&#39;))</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["18"],["   ml bottle near black body that s opaque in the glass and has an excellent tan head aroma spicy and sweet with more alcohol esters than expected for abv flavor dynamic with a sweet spicy start transitioning to a mildly bitter roasty and nutty flavor lots of dark roasted grain with negligible burnt aspects delicious roasted grain aftertaste overall intriguing aroma very good flavor outstanding mouthfeel closer to an american stout than a typical belgium stout worth seeking out characters chinchill jan report like   pours a deep brown that appears to be somewhat clear at the edges but must be quite murky since even direct sunlight will not pass through it the pour produces barely a finger of fine foamy tan head that leaves only a few thin streaks motes of lacing aroma is dark malt brown sugar molasses butter prune other dark fruits a little cocoa coffee taste is roasted burnt malt raisins brown sugar hints of molasses toffee with a little chocolate faint coffee thrown in there is a phenolic plastic note in the malty lively with carbonation finish aftertaste is rapidly fading burnt malt tangy cola dark fruit mouthfeel is medium heavy bodied with moderate high carbonation juicy slick peppery sandpaper prickly characters mothmanscott may report like   pours a cloudy dark brown with tan head sweetness chocolate bread and biscuit on the nose follows onto the palate finishes with a bready choclatey sweetness characters tx badger jun report like   enjoyed from the cl bottle in a sni"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>i<\/th>\n      <th>comments<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>The reviews are all still in one list per beer, so it is time to get them out of the list. In this blog post we also will only use the beer category and the text.</p>
<pre class="r"><code>input &lt;- input %&gt;% 
  select(beer_type, comments) %&gt;% 
  unnest(cols = c(beer_type, comments))</code></pre>
<p>So we increased the number of rows of our data frame from 3.978 (the number of beers) to 154.896 (the number of reviews).</p>
<p>Next we apply our function using purrr’s map_ch function. I also filter out small comments. This takes about a minute and a half.</p>
<pre class="r"><code>system.time(
input_text &lt;- input %&gt;%
  mutate(texts = map_chr(comments, treat_comment)) %&gt;% 
  select(-comments) %&gt;% 
  filter(str_length(texts) &gt; 40)
)</code></pre>
<pre><code>##    user  system elapsed 
##  101.84    0.08  101.98</code></pre>
<p>So that should be one review per row.</p>
<pre class="r"><code>head(input_text) %&gt;%
  select(texts)</code></pre>
<pre><code>## # A tibble: 6 x 1
##   texts                                                                    
##   &lt;chr&gt;                                                                    
## 1 &quot;   ml caged and corked fake bottle i see months and years but nothing i~
## 2 &quot;   aroma is fruit cherries malts mild chocolate and a musty hint the fl~
## 3 &quot;   did not really like this too confusing for my taste buds capped the ~
## 4 &quot;   such a cool and weird brew here a sour chocolate porter with cherrie~
## 5 &quot;   murky chocolate cherry with pitted sandstone head farmy smoky roast ~
## 6 &quot;   a dark brown with ruby highlights and a thin tan head that dissipate~</code></pre>
<p>Next up is language detection. cld3 is based on Google’s Compact Language Detector v3, a neural network model for language identification. It follows cld2 that used a Naïve Bayesian classifier. Let’s organise a little competition between the two.</p>
<pre class="r"><code>system.time(
input_text_language_3 &lt;- input_text %&gt;%
  mutate(language_3 = cld3::detect_language(text = texts)) 
)</code></pre>
<pre><code>##    user  system elapsed 
##  247.78    0.03  247.91</code></pre>
<pre class="r"><code>system.time(
input_text_language_2 &lt;- input_text %&gt;%
  mutate(language_2 = cld2::detect_language(text = texts)) 
)</code></pre>
<pre><code>##    user  system elapsed 
##    5.13    0.00    5.13</code></pre>
<p>So indeed cl2 is about 50 times faster. What about the language detection itself? How often do they disagree?</p>
<pre class="r"><code>input_text_language &lt;- input_text_language_2 %&gt;% 
  cbind(input_text_language_3$language_3) %&gt;% 
  rename(&quot;language_3&quot; = &quot;input_text_language_3$language_3&quot;) %&gt;% 
  mutate(diff = (language_2 == language_3))

diff &lt;- input_text_language %&gt;% 
  filter(diff == FALSE)

nrow(diff)</code></pre>
<pre><code>## [1] 16</code></pre>
<p>So that is not a big difference at all. Here is an example of where they do not give the same result:</p>
<pre class="r"><code>diff %&gt;% 
  select(language_2, texts) %&gt;% 
  slice(16) %&gt;%
  mutate(texts = substr(texts,1,1200)) %&gt;% 
   datatable(rownames = FALSE,  options = list(dom  = &#39;t&#39;))</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["nl"],["   this beer has the same story in connection to inbev as horse ale this brewery from the village of merchtem used to be a big local brewer to quote alfred van roy the former master brewer and owner of palm breweries mijn grote voorbeeld was jozef vanginderachter uit merchtem zegt alfred de maker van ginder ale de eerste die in belgië met zijn bier over de gemeentegrenzen wist te gaan ik had een grote bewondering voor hem zijn motto was ge kunt bier maken dat ge verkoopt aan de mensen maar ge kunt ook bier maken waar de mensen achter komen vragen dat is ook mijn betrachting geworden en het is mij ook gelukt als een van de weinigen one of the persons i admired most in life was jozef vanginderachter from merchtem the maker of ginder ale the first brewer in belgium that succeeded in selling his beer beyond village borders i had a admiration for him his motto was you can make a beer that you can sell to the people but you can also make a beer that people will ask for and i succeeded in doing this as one of the few now a days this beer is going through a great recession it is hardly offered in any interbrew café anymore the buildings from the old brewery still stand in the village of me"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>language_2<\/th>\n      <th>texts<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Both packages have a function to detect multiple languages, but cld2 seems better at it. At least on these 16 texts.</p>
<pre class="r"><code>cld2::detect_language_mixed(diff$texts[16])</code></pre>
<pre><code>## $classificaton
##   language code latin proportion
## 1  ENGLISH   en  TRUE       0.77
## 2    DUTCH   nl  TRUE       0.22
## 3  UNKNOWN   un  TRUE       0.00
## 
## $bytes
## [1] 2138
## 
## $reliabale
## [1] TRUE</code></pre>
<pre class="r"><code>cld3::detect_language_mixed(diff$texts[16])</code></pre>
<pre><code>##   language probability reliable proportion
## 1       en   0.9980431     TRUE          1
## 2      und   0.0000000    FALSE          0
## 3      und   0.0000000    FALSE          0</code></pre>
<p>Since we want the least possible foreign words we need to only keep the text classified as English texts.</p>
<p>What other languages do we have?</p>
<pre class="r"><code>input_text_language %&gt;% 
  group_by(language_2, language_3) %&gt;% 
  summarise(count = n()) %&gt;% 
  arrange(desc(count))</code></pre>
<pre><code>## # A tibble: 28 x 3
## # Groups:   language_2 [11]
##    language_2 language_3  count
##    &lt;chr&gt;      &lt;fct&gt;       &lt;int&gt;
##  1 en         en         152302
##  2 es         es            113
##  3 fr         fr             83
##  4 en         &lt;NA&gt;           67
##  5 &lt;NA&gt;       es             31
##  6 pt         pt             22
##  7 es         &lt;NA&gt;            7
##  8 it         it              7
##  9 fi         fi              4
## 10 es         en              3
## # ... with 18 more rows</code></pre>
<p>And what type of beers are the most reviewed?</p>
<pre class="r"><code>input_text_language &lt;- input_text_language %&gt;% 
  filter(language_3 == language_2) %&gt;% 
  filter(language_2 == &quot;en&quot;) %&gt;% 
  rename(&quot;language&quot; = &quot;language_2&quot;) %&gt;% 
  select(beer_type, texts)

top &lt;- 20

top_type &lt;- input_text_language %&gt;% 
  group_by(beer_type) %&gt;% 
  summarise(count = n()) %&gt;% 
  arrange(desc(count)) %&gt;% 
  slice(1:top)

top_type %&gt;% head(15)</code></pre>
<pre><code>## # A tibble: 15 x 2
##    beer_type                count
##    &lt;chr&gt;                    &lt;int&gt;
##  1 Belgian Strong Dark Ale  19689
##  2 Belgian Strong Pale Ale  15561
##  3 Belgian Tripel           15185
##  4 Belgian Quadrupel (Quad) 13525
##  5 Belgian Fruit Lambic     13468
##  6 Belgian Dubbel           11379
##  7 Belgian Saison            9588
##  8 Belgian Gueuze            7615
##  9 Belgian Pale Ale          7150
## 10 Flanders Red Ale          5697
## 11 Belgian Witbier           5385
## 12 &quot;Belgian Blonde Ale &quot;     4758
## 13 Belgian IPA               4239
## 14 Flanders Oud Bruin        3647
## 15 European Pale Lager       2082</code></pre>
<p>We’ll only look at the top commented beers with the tf-idf, because otherwise the stop words become more ‘special’ in the categories with the most words. In other words we need to have enough words (and stop words) in each category.</p>
<p>And we do not need to remove stop words because they will have low tf-idf scores. (We could even use the calculation to find stop-like words in a series of texts for other types of analyses.)</p>
<p>Now we take all words from the text, count them and calculate the tf, idf and tf_idf scores.</p>
<pre class="r"><code>beer_type_word &lt;- input_text_language %&gt;%
  filter(beer_type %in% top_type$beer_type) %&gt;% 
  unnest_tokens(word, texts) %&gt;%
  count(beer_type, word, sort = TRUE) %&gt;%
  ungroup() %&gt;% 
  rename(count=n) %&gt;%
  bind_tf_idf(word, beer_type, count)

beer_type_word %&gt;%
  filter(beer_type ==&quot;Belgian Saison&quot;) %&gt;% 
  select(-beer_type) %&gt;% 
  arrange(desc(tf_idf))</code></pre>
<pre><code>## # A tibble: 24,605 x 5
##    word      count        tf   idf   tf_idf
##    &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 fantome    2231 0.00165   0.357 0.000587
##  2 saisons    1283 0.000947  0.431 0.000408
##  3 dupont     1059 0.000781  0.431 0.000337
##  4 fantôme     421 0.000311  1.05  0.000326
##  5 fantomes    127 0.0000937 1.61  0.000151
##  6 dany        130 0.0000959 1.39  0.000133
##  7 blaugies     74 0.0000546 2.30  0.000126
##  8 printemps    62 0.0000457 2.30  0.000105
##  9 foret        88 0.0000649 1.61  0.000104
## 10 hiver        87 0.0000642 1.61  0.000103
## # ... with 24,595 more rows</code></pre>
<p>So the word ‘fantome’ is, given its relative presence (2231 times) in the category and</p>
<pre class="r"><code>beer_type_word %&gt;% filter(word == &quot;fantome&quot;) %&gt;%
  select(count) %&gt;% 
  sum() - 2231</code></pre>
<pre><code>## [1] 70</code></pre>
<p>its relative absence in the other categories (70 times), the most special word in the category compared</p>
<pre class="r"><code>beer_type_word %&gt;% filter(beer_type == &quot;Belgian Saison&quot;) %&gt;%
  select(count) %&gt;% 
  sum()</code></pre>
<pre><code>## [1] 1355411</code></pre>
<p>to all the words in the category (1.355.455 words).</p>
<p>For the Belgian strong dark ales the words are:</p>
<pre class="r"><code>beer_type_word %&gt;% 
  filter(beer_type == &quot;Belgian Strong Dark Ale&quot;) %&gt;%
  select(-beer_type) %&gt;% 
  arrange(desc(tf_idf))</code></pre>
<pre><code>## # A tibble: 33,918 x 5
##    word      count        tf    idf    tf_idf
##    &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
##  1 mahogany   1229 0.000476  0.163  0.0000773
##  2 chocolate  3754 0.00145   0.0513 0.0000746
##  3 noel        334 0.000129  0.431  0.0000557
##  4 raisin     2534 0.000981  0.0513 0.0000503
##  5 nocturnum   158 0.0000612 0.799  0.0000489
##  6 anker       133 0.0000515 0.916  0.0000472
##  7 prunes     1149 0.000445  0.105  0.0000469
##  8 figs       2267 0.000878  0.0513 0.0000450
##  9 cherries   2194 0.000850  0.0513 0.0000436
## 10 plum       2179 0.000844  0.0513 0.0000433
## # ... with 33,908 more rows</code></pre>
<p>Let us try to visualise this information. Here 15 with top tf_idf, and the number of times they appeared in the category.</p>
<pre class="r"><code>df &lt;- beer_type_word %&gt;% filter(beer_type ==&quot;Belgian Strong Dark Ale&quot;) %&gt;% 
  arrange(desc(tf_idf)) %&gt;% 
  slice(1:15)

ggplot(data = df, aes(x = count, y = tf_idf, label = word))+
  geom_point(size=.1, shape=0) + 
  geom_text_repel() +
  theme_minimal()</code></pre>
<p><img src="/post/2019-11-17-tf-idf-and-beer-reviews_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Hereunder more words and using plotly, so one can zoom in the areas the words appear too closely.</p>
<pre class="r"><code>df &lt;- beer_type_word %&gt;% filter(beer_type ==&quot;Belgian Strong Dark Ale&quot;) %&gt;%
  arrange(desc(tf_idf)) %&gt;% 
  slice(1:35)

p &lt;- ggplot(data = df, aes(x = count, y = tf_idf, label = word))+
  geom_point(size=.1, shape=0, color =&quot;white&quot;) + 
  geom_text(label=df$word) +
  theme_minimal()

ggplotly(p, tooltip = c(&quot;tf_idf&quot;, &quot;count&quot;))</code></pre>
<div id="htmlwidget-3" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"data":[{"x":[1229,3754,334,2534,158,133,1149,2267,2194,2179,1054,113,72,193,1903,865,81,51,88,1458,1369,666,242,192,35,72,127,93,68,78,116,25,47,185,1028],"y":[7.73432170692926e-005,7.45626368388531e-005,5.57148974136597e-005,5.03307729754006e-005,4.88542769306816e-005,4.7190147123e-005,4.68774859981732e-005,4.50275699823335e-005,4.35776305872253e-005,4.32796978348058e-005,4.30016277128587e-005,4.00938843977369e-005,3.86504317591104e-005,3.8176523697109e-005,3.7797735190287e-005,3.5290709650496e-005,3.29281352216076e-005,3.17841645307726e-005,3.12235559911579e-005,2.89590635351752e-005,2.71913292041529e-005,2.71718065054686e-005,2.69584278297944e-005,2.65179670687006e-005,2.57116081066138e-005,2.55465458109474e-005,2.51213394276313e-005,2.49617371777588e-005,2.41272932658947e-005,2.41179341809694e-005,2.29454753827184e-005,2.22906172118256e-005,2.19119451233781e-005,2.06087154897189e-005,2.04183246324829e-005],"text":["count: 1229<br />tf_idf: 7.734322e-05","count: 3754<br />tf_idf: 7.456264e-05","count:  334<br />tf_idf: 5.571490e-05","count: 2534<br />tf_idf: 5.033077e-05","count:  158<br />tf_idf: 4.885428e-05","count:  133<br />tf_idf: 4.719015e-05","count: 1149<br />tf_idf: 4.687749e-05","count: 2267<br />tf_idf: 4.502757e-05","count: 2194<br />tf_idf: 4.357763e-05","count: 2179<br />tf_idf: 4.327970e-05","count: 1054<br />tf_idf: 4.300163e-05","count:  113<br />tf_idf: 4.009388e-05","count:   72<br />tf_idf: 3.865043e-05","count:  193<br />tf_idf: 3.817652e-05","count: 1903<br />tf_idf: 3.779774e-05","count:  865<br />tf_idf: 3.529071e-05","count:   81<br />tf_idf: 3.292814e-05","count:   51<br />tf_idf: 3.178416e-05","count:   88<br />tf_idf: 3.122356e-05","count: 1458<br />tf_idf: 2.895906e-05","count: 1369<br />tf_idf: 2.719133e-05","count:  666<br />tf_idf: 2.717181e-05","count:  242<br />tf_idf: 2.695843e-05","count:  192<br />tf_idf: 2.651797e-05","count:   35<br />tf_idf: 2.571161e-05","count:   72<br />tf_idf: 2.554655e-05","count:  127<br />tf_idf: 2.512134e-05","count:   93<br />tf_idf: 2.496174e-05","count:   68<br />tf_idf: 2.412729e-05","count:   78<br />tf_idf: 2.411793e-05","count:  116<br />tf_idf: 2.294548e-05","count:   25<br />tf_idf: 2.229062e-05","count:   47<br />tf_idf: 2.191195e-05","count:  185<br />tf_idf: 2.060872e-05","count: 1028<br />tf_idf: 2.041832e-05"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(255,255,255,1)","opacity":1,"size":0.377952755905512,"symbol":"square-open","line":{"width":1.88976377952756,"color":"rgba(255,255,255,1)"}},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1229,3754,334,2534,158,133,1149,2267,2194,2179,1054,113,72,193,1903,865,81,51,88,1458,1369,666,242,192,35,72,127,93,68,78,116,25,47,185,1028],"y":[7.73432170692926e-005,7.45626368388531e-005,5.57148974136597e-005,5.03307729754006e-005,4.88542769306816e-005,4.7190147123e-005,4.68774859981732e-005,4.50275699823335e-005,4.35776305872253e-005,4.32796978348058e-005,4.30016277128587e-005,4.00938843977369e-005,3.86504317591104e-005,3.8176523697109e-005,3.7797735190287e-005,3.5290709650496e-005,3.29281352216076e-005,3.17841645307726e-005,3.12235559911579e-005,2.89590635351752e-005,2.71913292041529e-005,2.71718065054686e-005,2.69584278297944e-005,2.65179670687006e-005,2.57116081066138e-005,2.55465458109474e-005,2.51213394276313e-005,2.49617371777588e-005,2.41272932658947e-005,2.41179341809694e-005,2.29454753827184e-005,2.22906172118256e-005,2.19119451233781e-005,2.06087154897189e-005,2.04183246324829e-005],"text":["mahogany","chocolate","noel","raisin","nocturnum","anker","prunes","figs","cherries","plum","coffee","noël","elephants","rocs","ruby","rochefort","dragon","bok","keizer","fig","murky","prune","fruitcake","brune","ambrio","mcchouffe","grande","trappistes","achel","trappists","scaldis","jaargang","chimays","liquorice","licorice"],"hovertext":["count: 1229<br />tf_idf: 7.734322e-05","count: 3754<br />tf_idf: 7.456264e-05","count:  334<br />tf_idf: 5.571490e-05","count: 2534<br />tf_idf: 5.033077e-05","count:  158<br />tf_idf: 4.885428e-05","count:  133<br />tf_idf: 4.719015e-05","count: 1149<br />tf_idf: 4.687749e-05","count: 2267<br />tf_idf: 4.502757e-05","count: 2194<br />tf_idf: 4.357763e-05","count: 2179<br />tf_idf: 4.327970e-05","count: 1054<br />tf_idf: 4.300163e-05","count:  113<br />tf_idf: 4.009388e-05","count:   72<br />tf_idf: 3.865043e-05","count:  193<br />tf_idf: 3.817652e-05","count: 1903<br />tf_idf: 3.779774e-05","count:  865<br />tf_idf: 3.529071e-05","count:   81<br />tf_idf: 3.292814e-05","count:   51<br />tf_idf: 3.178416e-05","count:   88<br />tf_idf: 3.122356e-05","count: 1458<br />tf_idf: 2.895906e-05","count: 1369<br />tf_idf: 2.719133e-05","count:  666<br />tf_idf: 2.717181e-05","count:  242<br />tf_idf: 2.695843e-05","count:  192<br />tf_idf: 2.651797e-05","count:   35<br />tf_idf: 2.571161e-05","count:   72<br />tf_idf: 2.554655e-05","count:  127<br />tf_idf: 2.512134e-05","count:   93<br />tf_idf: 2.496174e-05","count:   68<br />tf_idf: 2.412729e-05","count:   78<br />tf_idf: 2.411793e-05","count:  116<br />tf_idf: 2.294548e-05","count:   25<br />tf_idf: 2.229062e-05","count:   47<br />tf_idf: 2.191195e-05","count:  185<br />tf_idf: 2.060872e-05","count: 1028<br />tf_idf: 2.041832e-05"],"textfont":{"size":14.6645669291339,"color":"rgba(0,0,0,1)"},"type":"scatter","mode":"text","hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":54.7945205479452},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-161.45,3940.45],"tickmode":"array","ticktext":["0","1000","2000","3000"],"tickvals":[0,1000,2000,3000],"categoryorder":"array","categoryarray":["0","1000","2000","3000"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.75720800106425e-005,8.01894616911331e-005],"tickmode":"array","ticktext":["2e-05","4e-05","6e-05","8e-05"],"tickvals":[2e-005,4e-005,6e-005,8e-005],"categoryorder":"array","categoryarray":["2e-05","4e-05","6e-05","8e-05"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.65296803652968,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"tf_idf","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"28ac5a16b29":{"x":{},"y":{},"label":{},"type":"scatter"},"28ac49c569b1":{"x":{},"y":{},"label":{}}},"cur_data":"28ac5a16b29","visdat":{"28ac5a16b29":["function (y) ","x"],"28ac49c569b1":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p>These are ok, but I guess I will need to learn Shiny soon.</p>
<p>Now for an overview of the top most reviewed beer types:</p>
<pre class="r"><code>top &lt;- 6

top_type &lt;- input_text_language %&gt;% 
  group_by(beer_type) %&gt;% 
  summarise(count = n()) %&gt;% 
  arrange(desc(count)) %&gt;% 
  slice(1:top)

beer_type_word %&gt;%
  filter(beer_type %in% top_type$beer_type) %&gt;% 
  mutate(word = make.names(word, unique = TRUE)) %&gt;% #this renames duplicate words
  arrange(beer_type, desc(-tf_idf)) %&gt;%
  mutate(word = factor(word, levels = rev(unique(word)))) %&gt;% 
  group_by(beer_type) %&gt;% 
  top_n(15) %&gt;%
  ungroup() %&gt;%
  ggplot(aes(x = reorder(word, tf_idf), y = tf_idf, fill = beer_type)) +
  scale_fill_viridis(discrete = TRUE, option = &quot;D&quot;)+
  scale_y_continuous(labels = scales::scientific)+
  geom_col(show.legend = FALSE) +
  labs(x = NULL, y = &quot;tf-idf&quot;) +
  facet_wrap(~beer_type, ncol = 2, scales = &quot;free&quot;) +
  coord_flip() + theme_minimal() +
  theme(axis.text=element_text(size=14),
        axis.title=element_text(size=28,face=&quot;bold&quot;)) + 
  theme(strip.text.x = element_text(size = 18, colour = &quot;black&quot;))</code></pre>
<p><img src="/post/2019-11-17-tf-idf-and-beer-reviews_files/figure-html/unnamed-chunk-21-1.png" width="1152" style="display: block; margin: auto;" /></p>
<p>Some of these words you might find surprising. The reviews can be searched to uncover the connections.</p>
<p>You might want to search for dancing alligators for instance.</p>
<p>All the best &amp; bitte ein bit ;-)</p>
<pre class="r"><code>search_words &lt;- c(&quot; alligators &quot;)

names(input_text) &lt;- c(&quot;beer_type&quot;, &quot;texts&quot;)
reviews &lt;- input_text %&gt;% 
  filter(str_detect(texts, search_words)) %&gt;% 
  select(-beer_type) %&gt;% 
  slice(1:1)

datatable(reviews, options = list(dom  = &#39;t&#39;))</code></pre>
<div id="htmlwidget-4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4">{"x":{"filter":"none","data":[["1"],["   hands down my favorite beer anything from delirium is good but the original is the best and i just love those pink elephants and dancing alligators characters bitte ein bit dec report like"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>texts<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>

      
      <div class="related">

<h3>Similar articles:</h3>
<ul>
	
	<li><a href="/post/beer-reviews-galore/">Beer reviews galore!</a></li>
	
	<li><a href="/post/the-belgian-beer-landscape/">The Belgian beer landscape</a></li>
	
</ul>
</div>
      
    </div>
    
  </div>
</section>


<section class="section">
  <div class="container">
    <aside><div id="disqus_thread"></div></aside>
  
    <div id="show_comments"><a id="load_comments" class="button is-link">Load comments</a></div>
  
    <script type="text/javascript">
      var disqus_shortname = 'bad-to-the-code';
      function disqus() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }
  
      
      var hash = window.location.hash.substr(1);
      if ((hash.length > 8) && (hash.substring(0, 8) === "comment-")) {
        disqus();
        document.getElementById("show_comments").style.display = "none";
      } else {
        document.getElementById('load_comments').onclick = function() {
          disqus();
          document.getElementById("show_comments").style.display = "none";
        };
      }
  

    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/madcap1090">William Bourgeois</a> 2019</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-137981534-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/matomo.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>
  <img src="//matomo.example.com/piwik.php?idsite=1&amp;rec=1" style="border:0" alt="" />
</noscript>


</body>
</html>

